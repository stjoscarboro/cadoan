app.factory("AirtableService",["$q","$http","DelayHttp",function(c,h,l){return{getData:function(f,d){var b=c.defer(),a=[],g=function(b,k){var e=c.defer();l({url:b+(k?"&offset="+k:""),method:"GET"}).then(function(c){(c.data.records||[]).forEach(function(b){var e={refId:b.id};d.tables[f].fields.forEach(function(a){switch(!0){case "date"===a:var c=new Date(Date.parse(b.fields[a]));c.setTime(c.getTime()+6E4*c.getTimezoneOffset());e[a]=c;break;case Array.isArray(b.fields[a]):e[a]=b.fields[a][0];break;
default:e[a]=b.fields[a]?""+b.fields[a]:""}});a.push(e)});c.data.offset?g(b,c.data.offset).then(function(){e.resolve()}):e.resolve()},function(a){e.reject(a.error)});return e.promise};g(d.url+"/"+f+"?api_key="+d.key).then(function(){a.sort(function(a,b){return parseInt(a.id)-parseInt(b.id)});b.resolve(a)},function(a){console.log(a)});return b.promise},createData:function(f,d,b){var a=c.defer();h({url:b.url+"/"+f+"?api_key="+b.key,method:"POST",data:d}).then(function(){a.resolve()},function(a){console.log("Error: "+
a.error)});return a.promise},updateData:function(f,d,b,a){var g=c.defer();h({url:a.url+"/"+f+"/"+d+"?api_key="+a.key,method:"PUT",data:b}).then(function(){g.resolve()},function(a){console.log("Error: "+a.error)});return g.promise},deleteData:function(f,d,b){var a=c.defer();h({url:b.url+"/"+f+"/"+d+"?api_key="+b.key,method:"DELETE"}).then(function(){a.resolve()},function(a){console.log("Error: "+a.error)});return a.promise}}}]);

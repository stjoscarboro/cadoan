var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,b){for(var d=1;d<arguments.length;d++){var f=arguments[d];if(f)for(var g in f)$jscomp.owns(f,g)&&(a[g]=f[g])}return a};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,d,f){if(b){d=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var g=a[f];g in d||(d[g]={});d=d[g]}a=a[a.length-1];f=d[a];b=b(f);b!=f&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var f=a.length,g=0;g<f;g++){var q=a[g];if(b.call(d,q,g,a))return{i:g,v:q}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
app.controller("ScheduleCtrl",["$scope","$q","$window","$uibModal","$timeout","$document","HttpService","DataService","FileService","AppUtil",function(a,b,d,f,g,q,t,k,r,m){a.init=function(){a.schedules=[];a.liturgies=[];a.singers=[];a.songs=[];a.categories=[];a.dateFormat="DD, dd/mm/yy";a.dayms=864E5;a.weekms=7*a.dayms;a.clear();q.ready(function(){0===d.angular.element(".signin").length&&a.loadData().then(function(){a.get()})})};a.signin=function(e,n){a.profile=e;a.accessToken=n;t.setAccessToken(n);
a.loadData().then(function(){a.get()})};a.get=function(){a.schedules=[];k.loadSchedules(a.songs).then(function(e){var n=new Date,b=(4<=e.length?e.slice(-4):e.slice(0))[0].date;n.setHours(0,0,0,0);b.setHours(0,0,0,0);e=$jscomp.makeIterator(e);for(var c=e.next();!c.done;c=e.next())if(c=c.value,a.accessToken||c.date>=n||c.date>=b){c.date=$.datepicker.formatDate(a.dateFormat,c.date);for(var d=$jscomp.makeIterator(a.liturgies),h=d.next();!h.done;h=d.next())h=h.value,h.id===c.liturgy.id&&h.year===c.liturgy.year&&
Object.assign(c.liturgy,m.pick(h,"name","year"));a.schedules.push(c)}m.resizeFrame(a)})};a.sort=function(){k.updateSchedule({requests:[{sortRange:{range:{sheetId:0},sortSpecs:[{dimensionIndex:0,sortOrder:"ASCENDING"}]}}]}).then(function(){a.clear();a.get()})};a.clear=function(){a.lists={};a.schedule={liturgy:{},songs:[]};a.rows=5};a.create=function(){var e=f.open({scope:a,templateUrl:"editor.html",backdrop:"static",backdropClass:"light",keyboard:!1,controller:function(){a.submit=function(){a.save().then(function(){e.close()})};
a.cancel=function(){a.clear();e.close()}}});e.opened.then(function(){g(function(){var e=function(){for(var e=$.datepicker.parseDate(a.dateFormat,a.schedule.date),c=$jscomp.makeIterator(a.liturgies),b=c.next();!b.done;b=c.next())b=b.value,e.getTime()===b.date.getTime()&&(Object.assign(a.schedule.liturgy,m.pick(b,"id","name","year")),a.schedule.liturgy.special||(a.schedule.liturgy.special=b.special))};$("#datepicker").datepicker({dateFormat:a.dateFormat,onSelect:function(b){a.schedule.date=b;a.schedule.liturgy=
{};e()}});if(!a.schedule.date)for(var b=$jscomp.makeIterator(a.schedules),c=b.next();!c.done;c=b.next()){c=$.datepicker.parseDate(a.dateFormat,c.value.date);var d=a.weekms-c.getDay()*a.dayms;a.schedule.date=$.datepicker.formatDate(a.dateFormat,new Date(c.getTime()+d))}e();(function(){if(0===a.schedule.songs.length)for(var b=0;5>b;b++)a.schedule.songs.push({category:a.categories[b]}),a.selectSongs(b)})();m.scrollFrame()},100)})};a.edit=function(b){a.schedule=angular.copy(a.schedules[b]);a.rows=a.schedule.songs.length;
(b=a.liturgies.find(function(b){return b.id===a.schedule.liturgy.id}))&&Object.assign(a.schedule.liturgy,m.pick(b,"name"));a.schedule.songs.forEach(function(b,e){var c=a.singers.find(function(a){return a.name===b.singer});c&&(b.singer=c.id);Object.assign(a.schedule.songs[e],m.pick(b,"id","category"));a.selectSongs(e)});a.create()};a.remove=function(e){var d=b.defer();k.updateSchedule({requests:[{deleteDimension:{range:{sheetId:0,dimension:"ROWS",startIndex:e,endIndex:e+1}}}]}).then(function(){a.schedules.splice(e,
1);d.resolve()});return d.promise};a.save=function(){for(var e=$.datepicker.parseDate(a.dateFormat,a.schedule.date),d={},f=[],c,g=[],h=b.defer(),p=$jscomp.makeIterator(a.schedule.songs),l=p.next();!l.done;l=p.next())f.push(Object.assign({},m.pick(l.value,"id","singer")));p=$jscomp.makeIterator(a.liturgies);for(l=p.next();!l.done;l=p.next())l=l.value,l.name===a.schedule.liturgy.name&&(a.schedule.liturgy.id=l.id);a.schedule.liturgy.id?Object.assign(d,m.pick(a.schedule.liturgy,"id","year","special")):
Object.assign(d,m.pick(a.schedule.liturgy,"name","year","special"));c={values:[[$.datepicker.formatDate("yy-mm-dd",e),JSON.stringify(d),JSON.stringify(f)]]};a.schedules.find(function(b,c){$.datepicker.parseDate(a.dateFormat,b.date).getTime()===e.getTime()&&g.push(a.remove(c))});b.all(g).then(function(){k.addSchedule(c).then(function(){a.sort();h.resolve()},function(a){console.log(a.data.error);h.reject()})});return h.promise};a.loadData=function(){var e=b.defer();b.all([r.listFolder("cadoan.sheets"),
k.loadLiturgies(),k.loadSingers()]).then(function(b){for(var d=$jscomp.makeIterator(b[0]),c=d.next();!c.done;c=d.next())Array.prototype.push.apply(a.songs,c.value);a.categories=k.listCategories(a.songs);a.liturgies=b[1];a.singers=b[2];k.sortByLocale(a.songs,"title");k.sortByLocale(a.singers,"name");k.sortCategories(a.categories);e.resolve()});return e.promise};a.selectSongs=function(b){var e=a.schedule.songs[b];if(e&&e.category){a.lists[b]={songs:[]};for(var d=$jscomp.makeIterator(a.songs),c=d.next();!c.done;c=
d.next())c=c.value,c.category===e.category&&a.lists[b].songs.push(c)}};a.previewSong=function(b){(b=a.schedule.songs[b])&&b.id&&d.open(r.getOpenURL(b.id),"_blank")}}]);

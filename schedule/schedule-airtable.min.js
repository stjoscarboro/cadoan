var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var e=0;return function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var e="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return e?e.call(a):$jscomp.arrayIterator(a)};$jscomp.owns=function(a,e){return Object.prototype.hasOwnProperty.call(a,e)};
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,e){for(var f=1;f<arguments.length;f++){var g=arguments[f];if(g)for(var k in g)$jscomp.owns(g,k)&&(a[k]=g[k])}return a};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,f){a!=Array.prototype&&a!=Object.prototype&&(a[e]=f.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,e,f,g){if(e){f=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var k=a[g];k in f||(f[k]={});f=f[k]}a=a[a.length-1];g=f[a];e=e(g);e!=g&&null!=e&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,e){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:e})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(f){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(f||"")+"_"+e++,f)}var e=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,e){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var f=0,g={next:function(){if(f<a.length){var k=f++;return{value:e(k,a[k]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.findInternal=function(a,e,f){a instanceof String&&(a=String(a));for(var g=a.length,k=0;k<g;k++){var n=a[k];if(e.call(f,n,k,a))return{i:k,v:n}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,f){return $jscomp.findInternal(this,a,f).v}},"es6","es3");
app.controller("ScheduleCtrl",["$scope","$q","$window","$uibModal","$timeout","$document","GoogleService","AirtableChoirService","AirtableLiturgyService","AirtableFilesService","AppUtil",function(a,e,f,g,k,n,q,m,p,r,l){a.init=function(){a.schedules=[];a.liturgies=[];a.singers=[];a.years=[];a.songs=[];a.categories=[];a.dateFormat="DD, dd/mm/yy";a.dayms=864E5;a.weekms=7*a.dayms;a.clear();n.ready(function(){0===f.angular.element(".signin").length&&a.loadData().then(function(){a.get()})})};a.signin=function(c,
d){a.profile=c;a.accessToken=d;q.setAccessToken(d);a.loadData().then(function(){a.get()})};a.get=function(){a.schedules=[];m.loadSchedules(a.songs).then(function(c){var d=new Date,e=(5<=c.length?c.slice(-5):c.slice(0))[0].date;d.setHours(0,0,0,0);e.setHours(0,0,0,0);var b={};c=$jscomp.makeIterator(c);for(var f=c.next();!f.done;b={$jscomp$loop$prop$schedule$12:b.$jscomp$loop$prop$schedule$12,$jscomp$loop$prop$categories$11:b.$jscomp$loop$prop$categories$11},f=c.next())if(b.$jscomp$loop$prop$schedule$12=
f.value,a.accessToken||b.$jscomp$loop$prop$schedule$12.date>=d||b.$jscomp$loop$prop$schedule$12.date>=e){f=$jscomp.makeIterator(a.liturgies);for(var h=f.next();!h.done;h=f.next())h=h.value,h.id===b.$jscomp$loop$prop$schedule$12.liturgy.id&&h.date.getTime()===b.$jscomp$loop$prop$schedule$12.date.getTime()&&(Object.assign(b.$jscomp$loop$prop$schedule$12.liturgy,l.pick(h,"name","year")),a.years.forEach(function(a){return function(b){b.id===a.$jscomp$loop$prop$schedule$12.liturgy.year&&(a.$jscomp$loop$prop$schedule$12.liturgy.year=
b)}}(b)),h.intention&&(b.$jscomp$loop$prop$schedule$12.liturgy.intention=h.intention));b.$jscomp$loop$prop$categories$11=b.$jscomp$loop$prop$schedule$12.songs.reduce(function(a,b){a[b.category]=(a[b.category]||0)+1;return a},{});Object.keys(b.$jscomp$loop$prop$categories$11).forEach(function(a){return function(b){if(1<a.$jscomp$loop$prop$categories$11[b]){var d=1;a.$jscomp$loop$prop$schedule$12.songs.forEach(function(a){a.category===b&&(a.category=b+" "+d++)})}}}(b));b.$jscomp$loop$prop$schedule$12.date=
$.datepicker.formatDate(a.dateFormat,b.$jscomp$loop$prop$schedule$12.date);a.schedules.push(b.$jscomp$loop$prop$schedule$12)}l.resizeFrame(a)})};a.clear=function(){a.lists={};a.schedule={liturgy:{},songs:[]};a.rows=5};a.refresh=function(){a.clear();a.get()};a.create=function(){var c=g.open({scope:a,templateUrl:"editor.html",backdrop:"static",backdropClass:"light",keyboard:!1,controller:function(){a.submit=function(){a.save().then(function(){c.close()})};a.cancel=function(){a.clear();c.close()}}});
c.opened.then(function(){k(function(){var d=function(){for(var b=$.datepicker.parseDate(a.dateFormat,a.schedule.date),c=$jscomp.makeIterator(a.liturgies),d=c.next();!d.done;d=c.next())d=d.value,b.getTime()===d.date.getTime()&&(Object.assign(a.schedule.liturgy,l.pick(d,"id","name","year")),a.schedule.liturgy.intention||(a.schedule.liturgy.intention=d.intention));b=$jscomp.makeIterator(a.years);for(c=b.next();!c.done;c=b.next())c=c.value,a.schedule.liturgy.year===c.id&&(a.schedule.liturgy.year=c)};
$("#datepicker").datepicker({dateFormat:a.dateFormat,onSelect:function(b){a.schedule.date=b;a.schedule.liturgy={};d()}});if(!a.schedule.date)for(var c=$jscomp.makeIterator(a.schedules),b=c.next();!b.done;b=c.next()){b=$.datepicker.parseDate(a.dateFormat,b.value.date);var e=a.weekms-b.getDay()*a.dayms;a.schedule.date=$.datepicker.formatDate(a.dateFormat,new Date(b.getTime()+e))}d();(function(){if(0===a.schedule.songs.length)for(var b=0;5>b;b++)a.schedule.songs.push({category:a.categories[b]}),a.selectSongs(b)})();
l.scrollFrame()},100)})};a.edit=function(c){a.schedule=angular.copy(a.schedules[c]);a.rows=a.schedule.songs.length;(c=a.liturgies.find(function(c){return c.id===a.schedule.liturgy.id}))&&Object.assign(a.schedule.liturgy,l.pick(c,"name"));a.schedule.songs.forEach(function(c,e){var b=a.singers.find(function(a){return a.name===c.singer});b&&(c.singer=b.id);Object.assign(a.schedule.songs[e],l.pick(c,"id","category"));a.selectSongs(e)});a.create()};a.remove=function(c){var d=e.defer();m.deleteSchedule((a.schedules[c]||
{}).refId).then(function(){a.schedules.splice(c,1);d.resolve()});return d.promise};a.save=function(){for(var c=$.datepicker.parseDate(a.dateFormat,a.schedule.date),d={},f=[],b=e.defer(),g=$jscomp.makeIterator(a.schedule.songs),h=g.next();!h.done;h=g.next())h=h.value,h.id&&f.push(Object.assign({},l.pick(h,"id","singer")));g=$jscomp.makeIterator(a.liturgies);for(h=g.next();!h.done;h=g.next())h=h.value,h.name===a.schedule.liturgy.name&&h.year===a.schedule.liturgy.year.id&&(a.schedule.liturgy.id=h.id,
a.schedule.liturgy.year=a.schedule.liturgy.year.id);a.schedule.liturgy.id?Object.assign(d,l.pick(a.schedule.liturgy,"id","year","intention")):Object.assign(d,l.pick(a.schedule.liturgy,"name","year","intention"));d.intention=d.intention&&d.intention.name&&!d.intention.id&&{name:d.intention.name}||null;!d.intention&&delete d.intention;c={date:$.datepicker.formatDate("yy-mm-dd",c),liturgy:JSON.stringify(d),songs:JSON.stringify(f)};(d=a.schedules.find(function(b){return b.date===a.schedule.date}))?m.updateSchedule(d.refId,
c).then(function(){a.refresh();b.resolve()}):m.createSchedule(c).then(function(){a.refresh();b.resolve()});b.resolve();return b.promise};a.loadData=function(){var c=e.defer();e.all([r.loadFiles(),p.loadYears(),p.loadLiturgies(),m.loadSingers()]).then(function(d){Array.prototype.push.apply(a.songs,d[0]);a.categories=m.listCategories(a.songs);a.categories.push("T\u1ea5t C\u1ea3");a.years=d[1];a.liturgies=d[2];a.singers=d[3];a.singers.unshift({id:null,name:null});m.sortByLocale(a.songs,"title");m.sortByLocale(a.singers,
"name");c.resolve()});return c.promise};a.selectSongs=function(c){var d=a.schedule.songs[c];if(d&&d.category){a.lists[c]={songs:[]};for(var e=$jscomp.makeIterator(a.songs),b=e.next();!b.done;b=e.next())b=b.value,-1!==d.category.indexOf(b.category)&&(d.category=b.category,a.lists[c].songs.push(b));0===a.lists[c].songs.length&&(a.lists[c].songs=a.songs)}};a.previewSong=function(c){(c=a.schedule.songs[c])&&c.id&&f.open(c.url,"_blank")};a.addSong=function(){a.rows+=1;a.schedule.songs.push({})};a.removeSong=
function(){--a.rows;a.schedule.songs.splice(a.rows,1)};a.tagHandler=function(){return null}}]);
